<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Grand Voting Competition - Sierra Leone</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                min-height: 100vh;
                color: #334155;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 1rem;
            }

            /* Header Styles */
            .header {
                background: white;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                border-bottom: 2px solid #e2e8f0;
                padding: 2rem 0;
                text-align: center;
                animation: slideDown 0.8s ease-out;
            }

            .logo {
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, #8b5cf6, #ec4899);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1.5rem;
                animation: bounceIn 1s ease-out 0.3s both;
            }

            .logo svg {
                width: 40px;
                height: 40px;
                fill: white;
            }

            .title {
                font-size: 2.5rem;
                font-weight: 700;
                background: linear-gradient(135deg, #8b5cf6, #ec4899);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 0.5rem;
                animation: fadeInUp 1s ease-out 0.5s both;
            }

            .subtitle {
                font-size: 1.25rem;
                color: #64748b;
                font-weight: 500;
                animation: fadeInUp 1s ease-out 0.7s both;
            }

            /* Main Content */
            .main-content {
                padding: 3rem 0;
            }

            .voting-card {
                background: white;
                border-radius: 1rem;
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
                padding: 2.5rem;
                margin-bottom: 2rem;
                animation: fadeInUp 1s ease-out 0.9s both;
            }

            .section-title {
                font-size: 1.5rem;
                font-weight: 600;
                color: #1e293b;
                margin-bottom: 1.5rem;
                text-align: center;
            }

            .form-group {
                margin-bottom: 1.5rem;
            }

            .form-label {
                display: block;
                font-weight: 500;
                color: #374151;
                margin-bottom: 0.5rem;
            }

            .form-input,
            .form-select {
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #e5e7eb;
                border-radius: 0.5rem;
                font-size: 1rem;
                transition: all 0.3s ease;
                background: white;
            }

            .form-input:focus,
            .form-select:focus {
                outline: none;
                border-color: #8b5cf6;
                box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            }

            .contestants-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }

            .contestant-card {
                border: 2px solid #e5e7eb;
                border-radius: 0.75rem;
                padding: 1rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                background: white;
            }

            .contestant-card:hover {
                border-color: #8b5cf6;
                transform: translateY(-2px);
                box-shadow: 0 8px 25px -5px rgba(139, 92, 246, 0.2);
            }

            .contestant-card.selected {
                border-color: #8b5cf6;
                background: #f3f4f6;
                box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            }

            .contestant-number {
                font-size: 1.5rem;
                font-weight: 700;
                color: #8b5cf6;
                margin-bottom: 0.5rem;
            }

            .contestant-name {
                font-weight: 600;
                color: #1e293b;
            }

            .submit-btn {
                width: 100%;
                background: linear-gradient(135deg, #8b5cf6, #ec4899);
                color: white;
                border: none;
                padding: 1rem;
                border-radius: 0.75rem;
                font-size: 1.125rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-top: 2rem;
            }

            .submit-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4);
            }

            .submit-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .payment-methods {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }

            .payment-method {
                border: 2px solid #e5e7eb;
                border-radius: 0.5rem;
                padding: 1rem;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                background: white;
            }

            .payment-method:hover {
                border-color: #8b5cf6;
            }

            .payment-method.selected {
                border-color: #8b5cf6;
                background: #f3f4f6;
            }

            .success-message {
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 1.5rem;
                border-radius: 0.75rem;
                text-align: center;
                margin-top: 2rem;
                animation: slideInUp 0.5s ease-out;
            }

            .error-message {
                background: linear-gradient(135deg, #ef4444, #dc2626);
                color: white;
                padding: 1.5rem;
                border-radius: 0.75rem;
                text-align: center;
                margin-top: 2rem;
                animation: shake 0.5s ease-out;
            }

            .hidden {
                display: none;
            }

            /* Animations */
            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes bounceIn {
                0% {
                    opacity: 0;
                    transform: scale(0.3);
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes shake {
                0%, 100% {
                    transform: translateX(0);
                }
                10%, 30%, 50%, 70%, 90% {
                    transform: translateX(-5px);
                }
                20%, 40%, 60%, 80% {
                    transform: translateX(5px);
                }
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .container {
                    padding: 0 0.5rem;
                }

                .title {
                    font-size: 2rem;
                }

                .subtitle {
                    font-size: 1rem;
                }

                .voting-card {
                    padding: 1.5rem;
                }

                .contestants-grid {
                    grid-template-columns: 1fr;
                }

                .payment-methods {
                    grid-template-columns: repeat(2, 1fr);
                }
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .stat-card {
                background: white;
                border-radius: 0.75rem;
                padding: 1.5rem;
                text-align: center;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                animation: fadeInUp 1s ease-out 1.1s both;
            }

            .stat-number {
                font-size: 2rem;
                font-weight: 700;
                color: #8b5cf6;
                margin-bottom: 0.5rem;
            }

            .stat-label {
                color: #64748b;
                font-weight: 500;
            }
        </style>
    </head>
    <body>
        <header class="header">
            <div class="container">
                <div class="logo">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <h1 class="title">Grand Voting Competition</h1>
                <p class="subtitle">Sierra Leone 2025</p>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <!-- Stats Section -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalVotes">0</div>
                        <div class="stat-label">Total Votes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">6</div>
                        <div class="stat-label">Categories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">30</div>
                        <div class="stat-label">Contestants</div>
                    </div>
                </div>

                <!-- Voting Form -->
                <div class="voting-card">
                    <h2 class="section-title">Cast Your Vote</h2>
                    
                    <form id="votingForm">
                        <div class="form-group">
                            <label class="form-label" for="voterName">Full Name *</label>
                            <input type="text" id="voterName" class="form-input" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="voterPhone">Phone Number *</label>
                            <input type="tel" id="voterPhone" class="form-input" placeholder="+232 XX XXX XXXX" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="category">Category *</label>
                            <select id="category" class="form-select" required>
                                <option value="">Select a category</option>
                                <option value="beauty">Beauty Contest (₦500)</option>
                                <option value="dolomite">Dolomite Competition (₦300)</option>
                                <option value="filing">Filing Challenge (₦200)</option>
                                <option value="youth">Youth Leadership (₦400)</option>
                                <option value="sim">SIM Innovation (₦350)</option>
                                <option value="place">Best Place (₦250)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Select Contestant *</label>
                            <div class="contestants-grid" id="contestantsGrid">
                                <!-- Contestants will be loaded here -->
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Payment Method *</label>
                            <div class="payment-methods">
                                <div class="payment-method" data-method="mobile_money">
                                    <div>📱</div>
                                    <div>Mobile Money</div>
                                </div>
                                <div class="payment-method" data-method="bank_transfer">
                                    <div>🏦</div>
                                    <div>Bank Transfer</div>
                                </div>
                                <div class="payment-method" data-method="cash">
                                    <div>💵</div>
                                    <div>Cash</div>
                                </div>
                                <div class="payment-method" data-method="card">
                                    <div>💳</div>
                                    <div>Card</div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="submit-btn">
                            Submit Vote
                        </button>
                    </form>

                    <div id="successMessage" class="success-message hidden">
                        <h3>Vote Submitted Successfully!</h3>
                        <p>Transaction ID: <span id="transactionId"></span></p>
                        <p>Thank you for participating in the Grand Voting Competition!</p>
                    </div>

                    <div id="errorMessage" class="error-message hidden">
                        <h3>Error Submitting Vote</h3>
                        <p id="errorText"></p>
                    </div>
                </div>
            </div>
        </main>

        <script type="module">
            // Firebase configuration
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
            import { getDatabase, ref, push, get, set, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

            const firebaseConfig = {
                apiKey: "AIzaSyBtYV2z9q2sCwn6qKceSVWJ7Rp1Rd8h9ls",
                authDomain: "eventvotingapp-4cb94.firebaseapp.com",
                databaseURL: "https://eventvotingapp-4cb94-default-rtdb.firebaseio.com",
                projectId: "eventvotingapp-4cb94",
                storageBucket: "eventvotingapp-4cb94.firebasestorage.app",
                messagingSenderId: "123456789012",
                appId: "1:123456789012:web:abc123def456ghi789"
            };

            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // Contestants data
            const contestantsData = {
                beauty: [
                    { id: 1, name: "Aminata Kamara" },
                    { id: 2, name: "Fatmata Sesay" },
                    { id: 3, name: "Isata Bangura" },
                    { id: 4, name: "Mariama Turay" },
                    { id: 5, name: "Hawa Conteh" }
                ],
                dolomite: [
                    { id: 1, name: "Mohamed Bangura" },
                    { id: 2, name: "Abdul Kamara" },
                    { id: 3, name: "Ibrahim Sesay" },
                    { id: 4, name: "Salifu Turay" },
                    { id: 5, name: "Foday Conteh" }
                ],
                filing: [
                    { id: 1, name: "Sarah Williams" },
                    { id: 2, name: "Agnes Koroma" },
                    { id: 3, name: "Memuna Jalloh" },
                    { id: 4, name: "Adama Fofana" },
                    { id: 5, name: "Kadiatu Bah" }
                ],
                youth: [
                    { id: 1, name: "Joseph Kamara" },
                    { id: 2, name: "Amadu Bangura" },
                    { id: 3, name: "Francis Sesay" },
                    { id: 4, name: "Samuel Turay" },
                    { id: 5, name: "Daniel Conteh" }
                ],
                sim: [
                    { id: 1, name: "Ahmed Hassan" },
                    { id: 2, name: "Brima Kargbo" },
                    { id: 3, name: "Alie Mansaray" },
                    { id: 4, name: "Musa Jalloh" },
                    { id: 5, name: "Abdulai Fofana" }
                ],
                place: [
                    { id: 1, name: "Freetown Peninsula" },
                    { id: 2, name: "Bo Township" },
                    { id: 3, name: "Kenema City" },
                    { id: 4, name: "Makeni Urban" },
                    { id: 5, name: "Koidu New Sembehun" }
                ]
            };

            // DOM elements
            const categorySelect = document.getElementById('category');
            const contestantsGrid = document.getElementById('contestantsGrid');
            const votingForm = document.getElementById('votingForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const totalVotesElement = document.getElementById('totalVotes');

            let selectedContestant = null;
            let selectedPaymentMethod = null;

            // Load contestants when category changes
            categorySelect.addEventListener('change', function() {
                const category = this.value;
                selectedContestant = null;
                loadContestants(category);
            });

            function loadContestants(category) {
                contestantsGrid.innerHTML = '';
                
                if (!category) return;

                const contestants = contestantsData[category] || [];
                
                contestants.forEach(contestant => {
                    const contestantCard = document.createElement('div');
                    contestantCard.className = 'contestant-card';
                    contestantCard.dataset.contestantId = contestant.id;
                    contestantCard.innerHTML = `
                        <div class="contestant-number">#${contestant.id}</div>
                        <div class="contestant-name">${contestant.name}</div>
                    `;
                    
                    contestantCard.addEventListener('click', function() {
                        document.querySelectorAll('.contestant-card').forEach(card => {
                            card.classList.remove('selected');
                        });
                        this.classList.add('selected');
                        selectedContestant = contestant.id;
                    });
                    
                    contestantsGrid.appendChild(contestantCard);
                });
            }

            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    selectedPaymentMethod = this.dataset.method;
                });
            });

            // Form submission
            votingForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Hide previous messages
                successMessage.classList.add('hidden');
                errorMessage.classList.add('hidden');
                
                // Validate form
                const voterName = document.getElementById('voterName').value.trim();
                const voterPhone = document.getElementById('voterPhone').value.trim();
                const category = categorySelect.value;
                
                if (!voterName || !voterPhone || !category || !selectedContestant || !selectedPaymentMethod) {
                    showError('Please fill in all required fields and make all selections.');
                    return;
                }

                // Validate Sierra Leone phone number
                const phoneRegex = /^\+232[0-9]{8}$/;
                if (!phoneRegex.test(voterPhone)) {
                    showError('Please enter a valid Sierra Leone phone number (+232XXXXXXXX).');
                    return;
                }

                try {
                    // Generate transaction ID
                    const transactionId = 'TXN-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    
                    // Submit vote to Firebase
                    const voteData = {
                        voterName,
                        voterPhone,
                        category,
                        contestantId: selectedContestant,
                        paymentMethod: selectedPaymentMethod,
                        transactionId,
                        timestamp: serverTimestamp()
                    };

                    await push(ref(database, 'votes'), voteData);
                    
                    // Update contestant vote count
                    await updateContestantVotes(category, selectedContestant);
                    
                    // Update total votes count
                    await updateTotalVotes();
                    
                    // Show success message
                    document.getElementById('transactionId').textContent = transactionId;
                    successMessage.classList.remove('hidden');
                    
                    // Reset form
                    votingForm.reset();
                    contestantsGrid.innerHTML = '';
                    selectedContestant = null;
                    selectedPaymentMethod = null;
                    document.querySelectorAll('.payment-method').forEach(m => {
                        m.classList.remove('selected');
                    });
                    
                } catch (error) {
                    console.error('Error submitting vote:', error);
                    showError('Failed to submit vote. Please try again.');
                }
            });

            async function updateContestantVotes(category, contestantId) {
                const contestantRef = ref(database, `contestants/${category}/${contestantId}/votes`);
                try {
                    const snapshot = await get(contestantRef);
                    const currentVotes = snapshot.val() || 0;
                    await set(contestantRef, currentVotes + 1);
                } catch (error) {
                    console.error('Error updating contestant votes:', error);
                }
            }

            async function updateTotalVotes() {
                try {
                    const snapshot = await get(ref(database, 'stats/totalVotes'));
                    const currentTotal = snapshot.val() || 0;
                    await set(ref(database, 'stats/totalVotes'), currentTotal + 1);
                    totalVotesElement.textContent = currentTotal + 1;
                } catch (error) {
                    console.error('Error updating total votes:', error);
                }
            }

            function showError(message) {
                document.getElementById('errorText').textContent = message;
                errorMessage.classList.remove('hidden');
            }

            // Load initial stats
            async function loadStats() {
                try {
                    const snapshot = await get(ref(database, 'stats/totalVotes'));
                    const totalVotes = snapshot.val() || 0;
                    totalVotesElement.textContent = totalVotes;
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            // Initialize
            loadStats();
        </script>
    </body>
</html>